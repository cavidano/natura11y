//////////////////////////////////////////////
// A. Modules
//////////////////////////////////////////////

@use 'sass:map';
@use 'sass:math';
@use './breakpoint';
@use './spacing';

//////////////////////////////////////////////
// B. Variables
//////////////////////////////////////////////

:root {
    --visible-panels: 1;

    --panel-peaking: var(--button-target-size);
}

$track-panels: 6;

//////////////////////////////////////////////
// C. Component
//////////////////////////////////////////////

@layer component {

    // Track Block

    .track,
    .track__container {
        position: relative;
    }

    .track {
        overflow: hidden;

        ul {
            list-style: none;
        }

        background-color: tan;
    }

    .track__container {
        position: relative;

        .track__prev,
        .track__next {
            position: absolute;
            inset-block-start: 50%;
            transform: translateY(-50%);
            
            z-index: 10;
        }

        .track__prev {
            inset-inline-start: 0;
        }

        .track__next {
            inset-inline-end: 0;
        }
    }
    
    .track--peaking {
            --_peaking: var(--panel-peaking);

        .track__container {
            position: relative;
            
            &::before {
                content: '';
                position: absolute;
                inset-block: 0;
                inset-inline-end: 0;
                width: var(--panel-peaking);
                background: var(--canvas);
                opacity: 0.5;
                pointer-events: none;
            }
        }

        .track__panels {
            padding-inline: var(--panel-peaking);
        }

        .track__panel:first-child {
            scroll-margin: 0;
            outline-color: blue;
        }

        .track__panel:not(:first-child) {
            scroll-margin: var(--panel-peaking);
            outline-color: red;
        }

    }

    .track__panels {
        display: grid;

        grid-auto-columns: calc((100% / var(--visible-panels)) - (var(--gap-size) * ((var(--visible-panels) - 1) / var(--visible-panels))));     
        grid-auto-flow: column;

        gap: var(--gap-size, 0);

        position: relative;
        overflow-x: auto;

        scroll-snap-type: inline mandatory;
        scroll-behavior: auto;

        /* Hide scrollbars */
        scrollbar-width: none;
        -ms-overflow-style: none;

        li {
            position: relative;
        }
            
        &:is(::-webkit-scrollbar) {
            display: none;
        }
    }

    .track__panel {
        position: relative;

        display: flex;
        flex-direction: column;

        outline: 4px solid green;
        outline-offset: -4px;

        scroll-snap-align: start;

        scroll-margin: 50px;

        > *:is(img, video) {
            width: 100%;
            height: auto;
        }
    }

    .track__panel__duplicate {
        position: absolute;

        inset: 0 0 0 100%;

        display: flex;
        width: var(--panel-peaking);
        
        height: 100%;

        margin-inline-start: var(--_gap);
        
        pointer-events: none;

        opacity: 0.5;

        > * {
            display: block;
        }

        display: none;

        // border: 2px solid red !important;
    }

    .track__controls {
        display: flex;
        justify-content: space-between;
        align-items: center;

        width: 100%;
    }

    .track__pagination {
        display: flex;
        justify-content: center;
        
        gap: 0.75em;
    }

    .track__pagination__item {
        --_size: calc(var(--button-target-size) * 0.5);

        container-type: inline-size;

        display: flex;

        width: var(--_size);
        height: var(--_size);

        background-color: currentColor;
        
        border-radius: 100%;

        cursor: pointer;

        &:is(
            .active,
            [aria-current='true']) 
        {
            background-color: transparent;

            outline: 3px solid currentColor;
            outline-offset: -3px;

            &::after {
                content: '';
                align-self: center;
                margin-inline: auto;

                width: 35cqi;
                height: 35cqi;

                background-color: currentColor;
                
                border-radius: 100%;
            }
        }
        
        &:focus-visible {
            outline: 3px solid var(--link-color) !important;
            outline-offset: 2px !important;
        }
    }

    .hide-controls :is(
        .track__controls,
        .track__prev,
        .track__next,
        .track__pagination
    ) {
        display: none;
    }

    // Generate responsive utility classes for different numbers of visible panels
    @each $breakpoint in map.keys(breakpoint.$breakpoints) {
        @include breakpoint.breakpoint-up($breakpoint) {
            $mod: breakpoint.breakpoint-modifier($breakpoint, breakpoint.$breakpoints);

            @for $i from 1 through $track-panels {
                .track--column-#{$i}#{$mod} {
                    --visible-panels: #{$i};
                }
            }
        }
    }

} // end @layer